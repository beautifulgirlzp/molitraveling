var myapp=angular.module("app",["ui.router","ngAnimate"]);myapp.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("index",{url:"/index",templateUrl:"view/index.html",controller:"index_ctr"}).state("PC.travel",{url:"/travel",templateUrl:"view/PC_travel.html"}).state("login",{url:"/login",templateUrl:"view/login.html",controller:"login_ctr"}).state("register",{url:"/register",templateUrl:"view/register.html",controller:"register_ctr"}).state("demo",{url:"/demo",templateUrl:"view/demo.html",controller:"demo_ctr"}).state("buy",{url:"/buy",templateUrl:"view/buy.html",controller:"buy_ctr"}).state("cates",{url:"/cates",templateUrl:"view/cates.html",controller:"cates_ctr"}).state("home",{url:"/home",templateUrl:"view/home.html"}).state("home.Am",{url:"/Am",templateUrl:"view/home_Am.html",controller:"home_Am_ctr"}).state("home.img",{url:"/img",templateUrl:"view/home_img.html",controller:"home_img_ctr"}),t.otherwise("index")}]),myapp.directive("gotop",function(){return{restrict:"A",link:function(e,t,o){var n=$(t);$(window).scroll(function(){$(document).scrollTop()>300?n.fadeIn(300):n.fadeOut(200)}),n.click(function(){$("html, body").animate({scrollTop:0},500)})}}}),myapp.controller("buy_ctr",["$scope","$http",function(e,t){function o(){n++,4==n&&(n=0),$("#buyBanner img").eq(n).fadeIn().siblings("img").fadeOut(),$("#buyBanner>.indicator span").eq(n).addClass("buyactive").siblings("span").removeClass("buyactive")}var n=0,r=setInterval(o,2e3);$("#buyBanner>.indicator span").on("click",function(){clearInterval(r);var e=$(this).index();$("#buyBanner img").eq(e).fadeIn().siblings("img").fadeOut(),$("#buyBanner>.indicator span").eq(e).addClass("buyactive").siblings("span").removeClass("buyactive"),r=setInterval(o,2e3)}),$("#buyUl li").hover(function(){$(this).stop(!0).animate({width:"400px"}).siblings("li").stop(!0).animate({width:"160px"})},function(){$(this).stop(!0).animate({width:"200px"}).siblings("li").stop(!0).animate({width:"200px"})})}]),myapp.controller("cates_ctr",["$scope","$http","$interval",function(e,t,o){t({url:"json/cates.json",type:"get"}).success(function(t){function n(){e.showIndex=(e.showIndex+1)%e.showText.length}e.showText=t.showText,e.imgBox=t.cates_main,e.showIndex=e.showText.length-1;var r=o(n,2e3);e.end=function(t){e.showIndex=t,o.cancel(r)},e.start=function(){r=o(n,2e3)}})}]),myapp.controller("demo_ctr",["$scope","$http",function(e,t){t({url:"json/message.json",type:"get"}).success(function(t){e.demo=t.demo}),e.mouseenter=function(e){$(".demo .main>.caseBox>.caseItem>.mask").eq(e).find(".maskone").css({animation:"fadeOut 2s forwards"}).siblings("div").css({animation:"fadeIn 2s forwards"})},e.mouseleave=function(e){$(".demo .main>.caseBox>.caseItem>.mask").eq(e).find(".maskone").css({animation:"null"}).siblings("div").css({animation:"null"})}}]),myapp.controller("home_Am_ctr",["$scope","$http","$interval",function(e,t,o){function n(){e.index=(e.index+1)%e.USA.imgList.length}t({url:"json/home.json",type:"get"}).success(function(t){e.USA=t.USA}),e.index=0;var r=o(n,3e3);e.clickFn=function(t){o.cancel(r),e.index=t,r=o(n,3e3)}}]),myapp.controller("home_img_ctr",["$scope","$http","$interval","$timeout",function(e,t,o,n){function r(){var e={columns:4};i(e)}function i(e){for(var t=$(".home_img .imgBox"),o=$(".home_img"),n=[],r=e.columns,i=0,s=0,a=0,l=1/r*95,c=1/(r-1)*5+l,m=[],u=0;u<r;u++)m.push(u*c+"%");for(t.css({width:l+"%"});i<t.length;i+=4)if(0!=i)for(var g=0;g<r;g++){var h=n.slice();sortArr=h.sort(function(e,t){return e>t});var p=n.indexOf(sortArr[0]);o.append(t.eq(i+g)),t.eq(i+g).animate({top:n[p]+"px",left:m[p]},1e3),a=t.eq(i+g).outerHeight(!0),n[p]+=a}else for(;s<r;s++)n.push(t.eq(s).outerHeight(!0)),o.append(t.eq(s)),t.eq(s).animate({left:m[s]},1e3);for(var i=0;i<r;i++)isNaN(n[i])&&(n.splice(i,1),i--,r--);var d=n.sort(function(e,t){return e<t})[0];$(".home_img").height(d+"px"),console.log(n)}t({url:"json/img.json",type:"get"}).success(function(t){e.imgList=t.imgs,n(r)})}]),myapp.controller("imp_ctr",["$rootScope",function(e){e.currentUser=[],localStorage.getItem("currentUser")||sessionStorage.getItem("currentUser")?e.loginShow=!0:e.loginShow=!1,e.key=localStorage.currentUser||sessionStorage.currentUser,e.cancelFn=function(){alert("退出成功!"),e.loginShow=!1,localStorage.removeItem("currentUser"),sessionStorage.removeItem("currentUser")}}]),myapp.controller("index_ctr",["$scope","$http","$rootScope",function(e,t,o){function n(){var e=window.innerHeight+"px";$(".section").height(e)}n(),$("body").css("overflow","hidden");var r=0,i=$(window);window.onresize=n;var s=0;i.on("mousewheel.a DOMMouseScroll.a",function(e){var t=(new Date).getTime(),e=e||event,o=e.originalEvent.wheelDelta&&(e.originalEvent.wheelDelta<0?1:-1)||e.originalEvent.detail&&(e.originalEvent.detail<0?-1:1);if(e.preventDefault(),s-t<-500){var n=i.scrollTop();r=parseInt(n/$(".section").height()),o>0?(r++,r>3&&(r=3)):(r--,r<0&&(r=0));var a=r*parseInt($(".section").height()),l=$("body,html");switch(r){case 0:l.stop(!0,!0).animate({scrollTop:a});break;case 1:l.stop(!0,!0).animate({scrollTop:a});break;case 2:l.stop(!0,!0).animate({scrollTop:a});break;case 3:l.stop(!0,!0).animate({scrollTop:a})}s=(new Date).getTime()}}),o.$on("$stateChangeStart",function(){$(window).off("mousewheel.a"),$(window).off("DOMMouseScroll.a"),$("body").css("overflow","auto")})}]),myapp.controller("login_ctr",["$scope","$rootScope","$interval","$state",function(e,t,o,n){function r(){var e=String((new Date).getTime());return e}e.loginBtnShow=!1,e.loginTelShow=!0,e.changeFn=function(t){t==e.loginTelNum?e.loginTelShow=!1:e.loginTelShow=!0};var i;e.loginBtnFn=function(){e.loginTelShow=!0,e.loginBtnShow=!e.loginBtnShow;var t=10;e.loginTelNum=Math.round(1e4*Math.random()),e.userPhoneValue="您的验证码为 :  "+e.loginTelNum,userForm.loginBtnValue.innerHTML=t+"s后可再次获取",i=o(function(){console.log(t),0==t?(e.loginBtnShow=!1,userForm.loginBtnValue.innerHTML="点击获取验证码"):userForm.loginBtnValue.innerHTML=t+"s后可再次获取",t--},1e3,11)},t.loginSubmitFn=function(){var e=r(),t={phone:userForm.userPhone.value,password:userForm.userPassword.value};window.localStorage&&localStorage.setItem(e,JSON.stringify(t)),o.cancel(i),alert("注册成功"),n.go("register")}}]),myapp.controller("register_ctr",["$scope","$rootScope","$state",function(e,t,o){e.userS=[],e.userN=[],e.userP=[],e.remember=!1,e.registerPhonePShow=!1,e.registerPasswordPShow=!1,e.registerPhoneP="*请输入正确的手机号码",e.registerPasswordP="*密码为6-12位";for(var n=window.localStorage,r=0;r<n.length;r++)e.userN.push(JSON.parse(n.getItem(n.key(r))).phone),e.userP.push(JSON.parse(n.getItem(n.key(r))).password);e.rememberMe=function(e,t){switch(console.log(e),e){case!0:localStorage.setItem("currentUser",t);break;case!1:sessionStorage.setItem("currentUser",t)}},e.rememberClick=function(){e.remember=!e.remember},e.registerClick=function(){e.registerPhonePShow=!1,e.registerPasswordPShow=!1;for(var n=0,r=0,i=0;i<e.userN.length;i++)if(userForm.userPhone.value==e.userN[i]){if(userForm.userPassword.value==e.userP[i])return e.rememberMe(e.remember,e.userN[i]),t.loginShow=!t.loginShow,void o.go("index");r++,e.registerPasswordP="密码输入错误",e.registerPasswordPShow=!0}else n++;n==e.userN.length&&(e.registerPhoneP="请检查您的手机号",e.registerPhonePShow=!0)}}]);